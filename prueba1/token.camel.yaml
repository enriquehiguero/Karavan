- route:
    id: get-token
    from:
      id: from-8891
      uri: direct
      parameters:
        name: get-token
      steps:
        - log:
            id: log-7391
            message: Iniciando obtención del token
        - undefined: {}
        - to:
            id: to-0cb7
            uri: http
            parameters:
              method: POST
              connectionTimeout: 5000
              httpClient.soTimeout: 10000
              httpUri: auth-service/token
        - choice:
            id: choice-7d5a
            when:
              - id: when-db7f
                expression:
                  simple:
                    id: simple-8e4e
                    expression: ${header.CamelHttpResponseCode} == 200
                steps:
                  - setProperty:
                      id: setProperty-60f7
                      name: tempToken
                      expression:
                        simple:
                          id: simple-f79c
                          expression: ${body}
                  - setProperty:
                      id: setProperty-4570
                      name: tokenExpiration
                      expression:
                        simple:
                          id: simple-cc87
                          expression: ${date:now:yyyy-MM-dd'T'HH:mm:ssZ}+3600000
                  - to:
                      id: to-5bc5
                      uri: properties
                  - to:
                      id: to-9fe2
                      uri: properties
                  - log:
                      id: log-07d3
                      message: >-
                        Token obtenido y guardado:
                        ${properties:globalAccessToken}
            otherwise:
              id: otherwise-9d02
              log:
                message: >-
                  Respuesta no válida del servidor de autenticación:
                  ${header.CamelHttpResponseCode}
