- rest:
    id: rest-students
    post:
      - id: post-d5af
        path: /studentV2
        to: direct:process-students
- route:
    id: route-3b6e
    nodePrefixId: route-77f
    from:
      id: from-f8a1
      uri: direct
      parameters:
        name: process-students
      steps:
        - log:
            id: log-a4bc
            message: Procesando estudiantes
        - choice:
            id: choice-e19e
            when:
              - id: when-b4d2
                expression:
                  simple:
                    id: simple-a81c
                    expression: ${exchangeProperty.globalAccessToken} == null
                steps:
                  - log:
                      id: log-bfb4
                      message: Token no disponible, obteniendo nuevo
                  - to:
                      id: to-0719
                      uri: direct
                      parameters:
                        name: get-token
            otherwise:
              id: otherwise-73de
              steps:
                - log:
                    id: log-0466
                    message: >-
                      Usando token existente:
                      ${exchangeProperty.globalAccessToken}
        - setBody:
            id: setBody-c083
            expression:
              simple:
                id: simple-6323
                expression: >-
                  {"status": "success", "token":
                  "${exchangeProperty.globalAccessToken}", "students": ${body}}
        - log:
            id: log-0862
            message: "Respuesta preparada: ${body}"
        - marshal:
            id: marshal-4db5
            json:
              id: json-7daa
